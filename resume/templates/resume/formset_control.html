  <script>
    function updateFormsIndex(el, prefix, ndx) {
      // FIXME: re-type own style
      var id_regex = new RegExp('(' + prefix + '-\\d+)');
      var replacement = prefix + '-' + ndx;

      // change label's for
      if ($(el).attr("for")) {
        $(el).attr("for", $(el).attr("for").replace(id_regex, replacement));
      }
      // change id
      if (el.id) {
        el.id = el.id.replace(id_regex, replacement);
      }
      // change name
      if (el.name) {
        el.name = el.name.replace(id_regex, replacement);
      }
    }

    // Add form
    $('#add-career').click(function() {
      var $totalFormsVal = $('#id_{{ formset.prefix }}-TOTAL_FORMS').val();
      var $totalFormsNum = parseInt($totalFormsVal);
      if($totalFormsNum < {{ formset.max_num }}) {
        // Add from empty_form
        $('.form-set').append($('.empty-form').html().replace(/__prefix__/g, $totalFormsVal));
        $('#id_{{ formset.prefix }}-TOTAL_FORMS').val($totalFormsNum+1);
      }
    });

    // Remove form
    $(document).on('click', '.close-career', function(e) {
      var $totalFormsVal = $('#id_{{ formset.prefix }}-TOTAL_FORMS').val();
      var $totalFormsNum = parseInt($totalFormsVal);

      if($totalFormsNum > 0) {
        // Close the career form
        $(this).closest('.career-form').remove();

        var $careerForms = $('.career-form');
        var $careerFormsNum = $careerForms.length - 1; 

        $('#id_{{ formset.prefix }}-TOTAL_FORMS').val($careerFormsNum); // exclude empty_form

        for(var i = 0; i < $careerFormsNum; i++) {
          $($careerForms.get(i)).find('.form-control, label').each(function() {
            updateFormsIndex(this, '{{ formset.prefix }}', i)
          });
        }

        return false;
      }
    });
  </script>
